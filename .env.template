# NCL Environment Configuration
# Copy this file to .env and fill in your values

# =============================================================================
# REQUIRED: User Input Needed (No Defaults)
# =============================================================================

# Supabase Configuration
# Get these from: https://supabase.com/dashboard → Project Settings
#
# SUPABASE_URL: Project URL (Settings → API → Project URL)
#   Example: https://abcdefghijkl.supabase.co
#
# SUPABASE_KEY: Service role key for backend operations (Settings → API → service_role secret)
#   ⚠️ Keep this secret! Never expose in frontend code
#   Example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
#
# SUPABASE_DB_URL: Direct PostgreSQL connection (Settings → Database → Connection string → URI)
#   Use the "Transaction pooler" connection string (port 5432) for best compatibility.
#   If you have IPv4 connectivity issues, use the "Session pooler" (port 5432) instead of direct connection.
#   Example: postgresql://postgres.[project-ref]:[password]@aws-0-[region].pooler.supabase.com:5432/postgres
#
SUPABASE_URL=
SUPABASE_KEY=
SUPABASE_DB_URL=

# OpenAI Configuration
# Get this from: https://platform.openai.com/api-keys
OPENAI_API_KEY=

# JWT Secret for API Authentication
# Get this from: Supabase Dashboard → Project Settings → API → JWT Secret
SUPABASE_JWT_SECRET=

# Cohere API Key (optional, but recommended for better search accuracy)
# Get this from: https://dashboard.cohere.com/api-keys
# Set RERANK_ENABLED=false below if you don't want to use reranking
COHERE_API_KEY=

# =============================================================================
# Model Configuration
# =============================================================================
EMBEDDING_MODEL=text-embedding-3-small
EMBEDDING_DIMENSIONS=1536
LLM_MODEL=gpt-4o-mini

# =============================================================================
# Chunking Configuration
# =============================================================================
CHUNK_SIZE_TOKENS=512
CHUNK_OVERLAP_TOKENS=50

# =============================================================================
# File Storage Paths
# =============================================================================
# Source data (user-provided, read-only) - supports subdirectories
DATA_SOURCE_DIR=./data/source

# Processed data (NCL-generated) - attachments and extracted files
DATA_PROCESSED_DIR=./data/processed

# Folder structure:
# data/
# ├── source/           # Place your EML files here (can use subdirectories)
# │   ├── inbox/
# │   ├── archive/2024/
# │   └── ...
# └── processed/        # NCL creates this automatically
#     ├── attachments/  # Extracted email attachments
#     └── extracted/    # Extracted ZIP contents

# =============================================================================
# Processing Options
# =============================================================================
BATCH_SIZE=10
MAX_CONCURRENT_EMBEDDINGS=5
EMBEDDING_BATCH_SIZE=100
ENABLE_OCR=true
ENABLE_PICTURE_DESCRIPTION=true

# =============================================================================
# ZIP Extraction Limits (DoS protection)
# =============================================================================
ZIP_MAX_FILES=100
ZIP_MAX_DEPTH=3
ZIP_MAX_TOTAL_SIZE_MB=500

# =============================================================================
# Reranker Configuration (improves search accuracy by 20-35%)
# =============================================================================
# Uses LiteLLM - supports multiple providers:
#   cohere/rerank-english-v3.0        - Cohere (default, requires COHERE_API_KEY)
#   cohere/rerank-multilingual-v3.0   - Cohere multilingual
#   together_ai/Salesforce/Llama-Rank-V1  - Together AI (requires TOGETHERAI_API_KEY)
#   deepinfra/Qwen/Qwen3-Reranker-0.6B    - DeepInfra (requires DEEPINFRA_API_KEY)
#   azure_ai/cohere-rerank-v3.5       - Azure AI (requires Azure credentials)
#   bedrock/amazon.rerank-v1:0        - AWS Bedrock (requires AWS credentials)
#   infinity/<model>                  - Self-hosted Infinity server
RERANK_ENABLED=true
RERANK_MODEL=cohere/rerank-english-v3.0
RERANK_TOP_N=5

# =============================================================================
# Display and Output
# =============================================================================
# Maximum characters of chunk content to display in source references
CHUNK_DISPLAY_MAX_CHARS=500

# Maximum error message length stored in database
ERROR_MESSAGE_MAX_LENGTH=1000

# =============================================================================
# API Configuration (for web interface)
# =============================================================================
# CORS origins (comma-separated for multiple origins)
CORS_ORIGINS=http://localhost:5173

# API server settings
API_HOST=0.0.0.0
API_PORT=8000
